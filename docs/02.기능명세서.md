# 기능 명세서

### FUNC-001: 회원가입

| 항목          | 내용                                                     |
| ------------- | -------------------------------------------------------- |
| 기능명        | 이메일 회원가입                                          |
| 관련 요구사항 | AUTH-001                                                 |
| 설명          | 사용자가 이메일과 비밀번호를 입력하여 새 계정을 생성한다 |

**선행 조건**

- 사용자가 회원가입 페이지에 접근한 상태
- 로그인하지 않은 상태

**입력 데이터**

| 필드          | 타입   | 필수 | 유효성 검사     |
| ------------- | ------ | ---- | --------------- |
| 이메일        | string | ✅   | 이메일 형식     |
| 비밀번호      | string | ✅   | 최소 6자 이상   |
| 비밀번호 확인 | string | ✅   | 비밀번호와 일치 |

**기본 흐름**

1. 사용자가 이메일을 입력한다
2. 사용자가 비밀번호를 입력한다
3. 사용자가 비밀번호 확인을 입력한다
4. 사용자가 "가입하기" 버튼을 클릭한다
5. 시스템이 입력값 유효성을 검사한다
6. 시스템이 Firebase에 계정을 생성한다
7. 시스템이 사용자를 메인 페이지로 이동시킨다
8. 시스템이 "회원가입이 완료되었습니다" 메시지를 표시한다

**예외 흐름**

| 조건               | 처리                                     |
| ------------------ | ---------------------------------------- |
| 이메일 형식 오류   | "올바른 이메일 형식을 입력해주세요" 표시 |
| 비밀번호 6자 미만  | "비밀번호는 6자 이상이어야 합니다" 표시  |
| 비밀번호 불일치    | "비밀번호가 일치하지 않습니다" 표시      |
| 이미 가입된 이메일 | "이미 사용 중인 이메일입니다" 표시       |

**결과**

- Firebase Authentication에 새 사용자 생성
- 사용자 로그인 상태로 전환

---

### FUNC-002: 게시글 작성

| 항목          | 내용                                              |
| ------------- | ------------------------------------------------- |
| 기능명        | 게시글 작성                                       |
| 관련 요구사항 | POST-001                                          |
| 설명          | 로그인한 사용자가 새로운 블로그 게시글을 작성한다 |

**선행 조건**

- 사용자가 로그인한 상태
- 글쓰기 페이지에 접근한 상태

**입력 데이터**

| 필드     | 타입   | 필수 | 유효성 검사       |
| -------- | ------ | ---- | ----------------- |
| 제목     | string | ✅   | 1~100자           |
| 내용     | string | ✅   | 1자 이상          |
| 카테고리 | string | ❌   | 선택 목록 중 하나 |

**기본 흐름**

1. 사용자가 제목을 입력한다
2. 사용자가 본문 내용을 입력한다
3. 사용자가 카테고리를 선택한다 (선택사항)
4. 사용자가 "발행하기" 버튼을 클릭한다
5. 시스템이 입력값 유효성을 검사한다
6. 시스템이 Firestore에 게시글을 저장한다
7. 시스템이 게시글 상세 페이지로 이동한다
8. 시스템이 "게시글이 발행되었습니다" 메시지를 표시한다

**예외 흐름**

| 조건        | 처리                                          |
| ----------- | --------------------------------------------- |
| 제목 미입력 | "제목을 입력해주세요" 표시                    |
| 내용 미입력 | "내용을 입력해주세요" 표시                    |
| 저장 실패   | "저장에 실패했습니다. 다시 시도해주세요" 표시 |

**저장 데이터 구조**

```tsx
{
  id: string,           // 자동 생성
  title: string,
  content: string,
  category: string | null,
  authorId: string,     // 현재 로그인 사용자 UID
  authorEmail: string,
  createdAt: Timestamp,
  updatedAt: Timestamp
}
```

**결과**

- Firestore posts 컬렉션에 새 문서 생성
- 게시글 목록에 새 글 표시

---

### FUNC-003: 게시글 목록 조회

| 항목          | 내용                                            |
| ------------- | ----------------------------------------------- |
| 기능명        | 게시글 목록 조회                                |
| 관련 요구사항 | POST-002, UX-001                                |
| 설명          | 모든 사용자가 게시글 목록을 최신순으로 조회한다 |

**선행 조건**

- 없음 (비로그인 사용자도 가능)

**기본 흐름**

1. 사용자가 메인 페이지에 접근한다
2. 시스템이 Firestore에서 게시글 목록을 조회한다
3. 시스템이 최신순으로 정렬하여 표시한다
4. 각 게시글은 제목, 작성자, 작성일, 카테고리를 표시한다

**표시 데이터**

| 항목     | 표시 형식                     |
| -------- | ----------------------------- |
| 제목     | 최대 50자, 초과 시 "..." 처리 |
| 작성자   | 이메일 @ 앞부분               |
| 작성일   | YYYY.MM.DD 형식               |
| 카테고리 | 태그 형태                     |

**예외 흐름**

| 조건           | 처리                              |
| -------------- | --------------------------------- |
| 게시글 없음    | "아직 게시글이 없습니다" 표시     |
| 조회 실패      | "게시글을 불러올 수 없습니다" 표시 |

---

### FUNC-004: 댓글 작성

| 항목          | 내용                                              |
| ------------- | ------------------------------------------------- |
| 기능명        | 댓글 작성                                         |
| 관련 요구사항 | CMT-001, CMT-002                                  |
| 설명          | 로그인한 사용자가 게시글에 댓글을 작성한다        |

**선행 조건**

- 사용자가 게시글 상세 페이지에 접근한 상태

**입력 데이터**

| 필드   | 타입   | 필수 | 유효성 검사 |
| ------ | ------ | ---- | ----------- |
| 내용   | string | ✅   | 1자 이상    |

**기본 흐름**

1. 로그인한 사용자가 댓글 입력란에 내용을 입력한다
2. 사용자가 "댓글 작성" 버튼을 클릭한다
3. 시스템이 입력값 유효성을 검사한다
4. 시스템이 Firestore에 댓글을 저장한다
5. 시스템이 댓글 목록을 새로고침한다
6. 시스템이 "댓글이 작성되었습니다" 메시지를 표시한다

**예외 흐름**

| 조건              | 처리                                        |
| ----------------- | ------------------------------------------- |
| 비로그인 상태     | 로그인 페이지로 이동                        |
| 내용 미입력       | "댓글 내용을 입력해주세요" 표시             |
| 저장 실패         | "댓글 작성에 실패했습니다" 표시             |

**저장 데이터 구조**

```tsx
{
  id: string,             // 자동 생성
  postId: string,         // 게시글 ID
  content: string,
  authorId: string,       // 작성자 UID
  authorEmail: string,
  authorDisplayName: string | null,
  createdAt: Timestamp
}
```

**결과**

- Firestore comments 컬렉션에 새 문서 생성
- 댓글 목록에 새 댓글 표시

---

### FUNC-005: 댓글 삭제

| 항목          | 내용                                              |
| ------------- | ------------------------------------------------- |
| 기능명        | 댓글 삭제                                         |
| 관련 요구사항 | CMT-003, CMT-004                                  |
| 설명          | 작성자가 자신의 댓글을 삭제한다                   |

**선행 조건**

- 사용자가 로그인한 상태
- 삭제할 댓글이 사용자가 작성한 댓글인 경우

**기본 흐름**

1. 사용자가 자신의 댓글에서 삭제 버튼을 클릭한다
2. 시스템이 "댓글을 삭제하시겠습니까?" 확인 다이얼로그를 표시한다
3. 사용자가 "삭제" 버튼을 클릭한다
4. 시스템이 Firestore에서 댓글을 삭제한다
5. 시스템이 댓글 목록을 새로고침한다
6. 시스템이 "댓글이 삭제되었습니다" 메시지를 표시한다

**예외 흐름**

| 조건              | 처리                                        |
| ----------------- | ------------------------------------------- |
| 다른 사용자 댓글  | 삭제 버튼 표시하지 않음                     |
| 삭제 실패         | "댓글 삭제에 실패했습니다" 표시             |

**결과**

- Firestore comments 컬렉션에서 문서 삭제
- 댓글 목록에서 해당 댓글 제거

---

### FUNC-006: 게시글 삭제 (관련 데이터 포함)

| 항목          | 내용                                                     |
| ------------- | -------------------------------------------------------- |
| 기능명        | 게시글 및 관련 데이터 삭제                               |
| 관련 요구사항 | POST-005, POST-009                                       |
| 설명          | 작성자가 게시글을 삭제하면 관련 댓글과 이미지도 삭제된다 |

**선행 조건**

- 사용자가 로그인한 상태
- 삭제할 게시글이 사용자가 작성한 게시글인 경우

**기본 흐름**

1. 사용자가 게시글에서 "삭제" 버튼을 클릭한다
2. 시스템이 경고 다이얼로그를 표시한다
   - 제목: "게시글을 삭제하시겠습니까?"
   - 메시지: "게시글 삭제 시 관련된 댓글과 이미지가 모두 삭제됩니다."
3. 사용자가 "삭제" 버튼을 클릭한다
4. 시스템이 게시글 본문에서 이미지 경로를 추출한다
5. 시스템이 병렬로 다음 작업을 수행한다:
   - 해당 게시글의 모든 댓글 삭제
   - Firebase Storage에서 이미지 파일 삭제
   - Firestore에서 게시글 문서 삭제
6. 시스템이 메인 페이지로 이동한다
7. 시스템이 "게시글이 삭제되었습니다" 메시지를 표시한다

**예외 흐름**

| 조건         | 처리                              |
| ------------ | --------------------------------- |
| 삭제 실패    | "삭제에 실패했습니다" 표시        |

**결과**

- Firestore posts 컬렉션에서 문서 삭제
- Firestore comments 컬렉션에서 관련 댓글 삭제
- Firebase Storage에서 관련 이미지 파일 삭제
